fn:string passPrinter(result) -> str {
    ;;; bug with the scoping here
    string "empty" -> val;
    if(result == TRUE) {
        string "PASS" -> val;
    } else {
        string "FAIL" -> val;
    }
    string val -> str;
}

fn:list testFindA(results) -> results
{
    find ([[animal dog] [animal cat][vehicle car] [vehicle train]],
          [animal ?all]) -> result;
    matches(result, [[animal dog] [animal cat]]) -> test;
    matches(all, [dog cat]) -> test_B;
    bool (test && test_B) -> passb;
    call passPrinter(passb) -> pass;
    list [^^results ^pass] -> results;
}

fn:list testFindB(results) -> results
{
    find ([[animal dog] [animal cat][vehicle car] [vehicle train]],
          [animal ?all]) -> result;

    ;;; now try again but with vehicle, should override the first set
    find ([[animal dog] [animal cat][vehicle car] [vehicle train]],
          [vehicle ?all]) -> result;

    matches(result, [[vehicle car] [vehicle train]]) -> test;
    matches(all, [car train]) -> test_B;
    bool (test && test_B) -> passb;
    call passPrinter(passb) -> pass;
    list [^^results ^pass] -> results;
}

start {
    list [] -> results;
    call testFindA(results) -> results;
    call testFindB(results) -> results;

    ;;; Generate test summary
    prn results;
    find(results, [FAIL]) -> failures;
    find(results, [PASS]) -> passes;
    length failures -> fc;
    length passes -> pc;
    say fc; prn " failures.";
    say pc; prn " passes.";
}